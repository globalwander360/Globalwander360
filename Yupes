

âœ… 1. TEST CLASS â€” (Mock setup for dpwEventHelper)

These lines belong in your JUnit test class (e.g., EventServiceTest.java):

// âœ… Mocks used only in test
String eventId = "event1234";
AlertEntity alertEntity = new AlertEntity();
ReminderEntity reminderEntity = new ReminderEntity();
AlertReminderDetail alertReminderDetail = new AlertReminderDetail();
alertReminderDetail.setCreationDate(LocalDateTime.now());

// âœ… Mocking dependencies
given(dpwEventHelper.getEventAlertsFuture(eventId))
        .willReturn(CompletableFuture.completedFuture(Lists.newArrayList(alertEntity)));

given(dpwEventHelper.getEventReminderFuture(eventId))
        .willReturn(CompletableFuture.completedFuture(Lists.newArrayList(reminderEntity)));

given(dpwEventHelper.getAlertReminderDetail(any(AlertEntity.class)))
        .willReturn(alertReminderDetail);

given(dpwEventHelper.getAlertReminderDetail(any(ReminderEntity.class), anyString()))
        .willReturn(alertReminderDetail);

// âœ… Call the method under test
TreeviewAlertReminderPage actual = service.getAlertReminderForTreeViewByEventId(
        "30804", 8, 18, "uid", eventId);

// âœ… Assert result
assertEquals(2, actual.getResults().size());


---

âœ… 2. DEVELOPMENT (SERVICE) CLASS â€” (Fix broken thenCombine logic)

These changes go in your actual service method, e.g., EventServiceImpl.java inside the method:

getAlertReminderForTreeViewByEventId(String branchCode, Integer skip, Integer take, String bnppuid, String eventId)

ðŸ”§ Replace this broken line:

.thenCombine(dpwEventHelper.getEventAlertsFuture(eventId), (alertReminderDetailList, alertEntities) -> {
    alertReminderDetailList.addAll(.toList()); // âŒ invalid
    alertEntities.stream().map(ard -> dpwEventHelper.getAlertReminderDetail(ard))
    return alertReminderDetailList;
})

âœ… With this correct version:

.thenCombine(dpwEventHelper.getEventReminderFuture(eventId), (alertEntities, reminderEntities) -> {
    List<AlertReminderDetail> detailList = new ArrayList<>();

    for (AlertEntity alert : alertEntities) {
        detailList.add(dpwEventHelper.getAlertReminderDetail(alert));
    }

    for (ReminderEntity reminder : reminderEntities) {
        detailList.add(dpwEventHelper.getAlertReminderDetail(reminder, bnppuid));
    }

    return detailList.stream()
        .sorted(Comparator.comparing(AlertReminderDetail::getCreationDate))
        .collect(Collectors.toList());
})


---

ðŸŸ¢ Summary:

Purpose	File	Code Snippet

Test mocking + check	EventServiceTest.java	given(...).willReturn(...), assertEquals(...)
Business logic fix	EventServiceImpl.java	Fix thenCombine(...) logic to properly map alerts & reminders


Let me know if youâ€™d like me to paste the entire fixed service method in one go.
