

✅ 1. TEST CLASS — (Mock setup for dpwEventHelper)

These lines belong in your JUnit test class (e.g., EventServiceTest.java):

// ✅ Mocks used only in test
String eventId = "event1234";
AlertEntity alertEntity = new AlertEntity();
ReminderEntity reminderEntity = new ReminderEntity();
AlertReminderDetail alertReminderDetail = new AlertReminderDetail();
alertReminderDetail.setCreationDate(LocalDateTime.now());

// ✅ Mocking dependencies
given(dpwEventHelper.getEventAlertsFuture(eventId))
        .willReturn(CompletableFuture.completedFuture(Lists.newArrayList(alertEntity)));

given(dpwEventHelper.getEventReminderFuture(eventId))
        .willReturn(CompletableFuture.completedFuture(Lists.newArrayList(reminderEntity)));

given(dpwEventHelper.getAlertReminderDetail(any(AlertEntity.class)))
        .willReturn(alertReminderDetail);

given(dpwEventHelper.getAlertReminderDetail(any(ReminderEntity.class), anyString()))
        .willReturn(alertReminderDetail);

// ✅ Call the method under test
TreeviewAlertReminderPage actual = service.getAlertReminderForTreeViewByEventId(
        "30804", 8, 18, "uid", eventId);

// ✅ Assert result
assertEquals(2, actual.getResults().size());


---

✅ 2. DEVELOPMENT (SERVICE) CLASS — (Fix broken thenCombine logic)

These changes go in your actual service method, e.g., EventServiceImpl.java inside the method:

getAlertReminderForTreeViewByEventId(String branchCode, Integer skip, Integer take, String bnppuid, String eventId)

🔧 Replace this broken line:

.thenCombine(dpwEventHelper.getEventAlertsFuture(eventId), (alertReminderDetailList, alertEntities) -> {
    alertReminderDetailList.addAll(.toList()); // ❌ invalid
    alertEntities.stream().map(ard -> dpwEventHelper.getAlertReminderDetail(ard))
    return alertReminderDetailList;
})

✅ With this correct version:

.thenCombine(dpwEventHelper.getEventReminderFuture(eventId), (alertEntities, reminderEntities) -> {
    List<AlertReminderDetail> detailList = new ArrayList<>();

    for (AlertEntity alert : alertEntities) {
        detailList.add(dpwEventHelper.getAlertReminderDetail(alert));
    }

    for (ReminderEntity reminder : reminderEntities) {
        detailList.add(dpwEventHelper.getAlertReminderDetail(reminder, bnppuid));
    }

    return detailList.stream()
        .sorted(Comparator.comparing(AlertReminderDetail::getCreationDate))
        .collect(Collectors.toList());
})


---

🟢 Summary:

Purpose	File	Code Snippet

Test mocking + check	EventServiceTest.java	given(...).willReturn(...), assertEquals(...)
Business logic fix	EventServiceImpl.java	Fix thenCombine(...) logic to properly map alerts & reminders


Let me know if you’d like me to paste the entire fixed service method in one go.
