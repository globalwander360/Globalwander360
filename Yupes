@Test
public void testGetPropertyNames_Success() {
    String eventid = "evt123";
    Map<String, String> propertyIdNameMap = new HashMap<>();
    propertyIdNameMap.put("1", "Name1");
    propertyIdNameMap.put("2", "Name2");

    List<Long> mockPropertyIds = Arrays.asList(1L, 2L, 3L); // 3L is not in map

    when(transactionPropertyService.getPropertyNamesByEventidAndType(eventid, "COMPLETION_MOTIVE"))
        .thenReturn(mockPropertyIds);

    String result = yourService.getPropertyNames(eventid, propertyIdNameMap);

    assertEquals("Name1,Name2", result);
}


@Test
public void testGetPropertyNames_EmptyAfterFiltering() {
    String eventid = "evt456";
    Map<String, String> propertyIdNameMap = new HashMap<>(); // no valid entries

    List<Long> mockPropertyIds = Arrays.asList(10L, 20L);

    when(transactionPropertyService.getPropertyNamesByEventidAndType(eventid, "COMPLETION_MOTIVE"))
        .thenReturn(mockPropertyIds);

    String result = yourService.getPropertyNames(eventid, propertyIdNameMap);

    assertNull(result);
}
@Test
public void testGetPropertyNames_ExceptionThrown() {
    String eventid = "evt789";
    Map<String, String> propertyIdNameMap = new HashMap<>();

    when(transactionPropertyService.getPropertyNamesByEventidAndType(eventid, "COMPLETION_MOTIVE"))
        .thenThrow(new RuntimeException("Service error"));

    String result = yourService.getPropertyNames(eventid, propertyIdNameMap);

    assertNull(result);
}

@Test
public void testExportEvents_WithValidPropertyNames() {
    String bnppuid = "user123";
    String eventId = "101";

    // Mock input event
    EventExportDTO mockDto = new EventExportDTO();
    mockDto.setId(eventId);

    List<EventExportDTO> eventList = List.of(mockDto);

    // Mock map returned by service method
    Map<String, String> propertyIdNameMap = new HashMap<>();
    propertyIdNameMap.put("1", "Name1");
    propertyIdNameMap.put("2", "Name2");

    // Stub method
    when(requestServiceImpl.getPropertyIdNames(bnppuid)).thenReturn(propertyIdNameMap);
    when(yourService.getPropertyNames(eventId, propertyIdNameMap)).thenReturn("Name1,Name2");

    // Mock event list page and mapping
    EventListsPage mockPage = mock(EventListsPage.class);
    when(mockPage.getResults()).thenReturn(List.of(new EventEntity()));

    when(eventService.filterEvents(any(), any(), eq(bnppuid), eq(true), any(), any(), any(), any()))
        .thenReturn(mockPage);
    when(eventMapper.mapToEventExportDTOList(any())).thenReturn(eventList);

    // Call the method under test
    ResponseEntity<?> response = yourService.exportEvents(...); // pass required args

    // Assertions
    assertEquals(HttpStatus.OK, response.getStatusCode());
    assertEquals("Name1,Name2", mockDto.getTransactionPropertyName());
}


@Test
public void testExportIntradayEvents_Success() throws Exception {
    String bnppuid = "user123";
    String branchCode = "BR01";
    String countryCode = "IN";
    String timezone = "Asia/Kolkata";

    ExportRequest export = mock(ExportRequest.class);
    when(export.getColumns()).thenReturn(List.of("col1", "col2"));
    when(export.getPgpeCodes()).thenReturn(List.of("PG1"));
    when(export.getExcelHeaders()).thenReturn(List.of("Header1", "Header2"));

    // Mock propertyIdNameMap
    Map<String, String> propertyIdNameMap = new HashMap<>();
    propertyIdNameMap.put("1", "PropName1");
    when(requestServiceImpl.getPropertyIdNames(bnppuid)).thenReturn(propertyIdNameMap);

    // Mock event entity
    EventEntity eventEntity = new EventEntity();
    EventListsPage eventListsPage = mock(EventListsPage.class);
    when(eventListsPage.getResults()).thenReturn(List.of(eventEntity));
    when(eventListsPage.getExcelCount()).thenReturn(1);

    when(eventService.filterEvents(any(), any(), eq(bnppuid), eq(true), any(), eq(branchCode), eq(countryCode), any()))
        .thenReturn(eventListsPage);

    // Mock DTO
    EventExportDTO dto = new EventExportDTO();
    dto.setId("1");
    dto.setCusBusinessCenterId("C1");
    dto.setBranchCode("B1");

    when(eventMapper.mapToEventExportDtoList(any())).thenReturn(List.of(dto));
    when(yourService.getPropertyNames("1", propertyIdNameMap)).thenReturn("PropName1");

    // Mock CSV export
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    CsvExportHelper<EventExportDTO> csvHelper = mock(CsvExportHelper.class);
    when(csvHelper.createFileContent(1)).thenReturn(bos);
    when(csvHelper.generateMultipleHeaders(bos)).thenReturn(new HttpHeaders());

    when(csvExportHelperFactory.createHelper(any(), any(), any(), any())).thenReturn(csvHelper);
    when(eventService.getIntradayReportSequence()).thenReturn(BigInteger.valueOf(12345));

    // Call actual method
    ResponseEntity<byte[]> response = yourService.exportIntradayEvents(export, bnppuid, branchCode, countryCode, timezone);

    assertEquals(HttpStatus.OK, response.getStatusCode());
    assertNotNull(response.getBody());
}
